
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Stoner.folders.mixins &#8212; Stoner Pacakge API Documentation</title>
    <link rel="stylesheet" href="../../../_static/better.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  </head><body>
    <header id="pageheader"><h1><a href="../../../index.html ">
        Stoner Pacakge API Documentation
    </a></h1></header>
  <div class="related top">
  <nav id="rellinks">
    <ul>
    </ul>
  </nav>
  <nav id="breadcrumbs">
    <ul>
      <li><a href="../../../index.html">Stoner Package</a></li>
      <li>
        <a href="../../index.html">Module code</a>
      </li> 
    </ul>
  </nav>
  </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for Stoner.folders.mixins</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;mixin calsses for :py:class:`Stoner.folders.core.baseFoler`.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DiskBasedFolderMixin&quot;</span><span class="p">,</span> <span class="s2">&quot;DataMethodsMixin&quot;</span><span class="p">,</span> <span class="s2">&quot;PlotMethodsMixin&quot;</span><span class="p">]</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span> <span class="k">as</span> <span class="nn">path</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>

<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">append</span><span class="p">,</span> <span class="nb">any</span> <span class="k">as</span> <span class="n">np_any</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">ceil</span>
<span class="kn">from</span> <span class="nn">numpy.ma</span> <span class="kn">import</span> <span class="n">masked_invalid</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">figure</span><span class="p">,</span> <span class="n">Figure</span><span class="p">,</span> <span class="n">subplot</span><span class="p">,</span> <span class="n">tight_layout</span>

<span class="kn">from</span> <span class="nn">Stoner.compat</span> <span class="kn">import</span> <span class="n">string_types</span><span class="p">,</span> <span class="n">get_filedialog</span><span class="p">,</span> <span class="n">_pattern_type</span><span class="p">,</span> <span class="n">makedirs</span>
<span class="kn">from</span> <span class="nn">Stoner.tools</span> <span class="kn">import</span> <span class="n">isIterable</span><span class="p">,</span> <span class="n">make_Data</span>
<span class="kn">from</span> <span class="nn">Stoner.core.base</span> <span class="kn">import</span> <span class="n">metadataObject</span><span class="p">,</span> <span class="n">string_to_type</span>
<span class="kn">from</span> <span class="nn">Stoner.core.exceptions</span> <span class="kn">import</span> <span class="n">StonerUnrecognisedFormat</span>
<span class="kn">from</span> <span class="nn">.core</span> <span class="kn">import</span> <span class="n">baseFolder</span><span class="p">,</span> <span class="n">__add_core__</span> <span class="k">as</span> <span class="n">_base__add_core__</span><span class="p">,</span> <span class="n">__sub_core__</span> <span class="k">as</span> <span class="n">_base__sub_core__</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">scan_dir</span><span class="p">,</span> <span class="n">discard_earlier</span><span class="p">,</span> <span class="n">filter_files</span><span class="p">,</span> <span class="n">get_pool</span><span class="p">,</span> <span class="n">removeDisallowedFilenameChars</span>
<span class="kn">from</span> <span class="nn">Stoner.core.exceptions</span> <span class="kn">import</span> <span class="n">assertion</span>


<span class="n">regexp_type</span> <span class="o">=</span> <span class="p">(</span><span class="n">_pattern_type</span><span class="p">,)</span>


<span class="k">def</span> <span class="nf">__add_core__</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Additional logic for the add operator.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
        <span class="n">othername</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">othername</span><span class="p">)</span> <span class="ow">and</span> <span class="n">othername</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">othername</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> either does not exist of is already in the folder.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">othername</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_base__add_core__</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">__sub_core__</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Additional logic to check for match to basenames.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">other</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">basenames</span><span class="p">)</span> <span class="ow">and</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">ls</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">__deleter__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">_base__sub_core__</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_loader</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">loader</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Lods and returns an object.&quot;&quot;&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">else</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">typ</span><span class="p">(</span><span class="n">loader</span><span class="p">(</span><span class="n">filename</span><span class="p">)),</span> <span class="n">name</span>


<div class="viewcode-block" id="DiskBasedFolderMixin"><a class="viewcode-back" href="../../../classes/Stoner.folders.mixins.DiskBasedFolderMixin.html#Stoner.DiskBasedFolderMixin">[docs]</a><span class="k">class</span> <span class="nc">DiskBasedFolderMixin</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;A Mixin class that implmenets reading metadataObjects from disc.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        type (:py:class:`Stoner.Core.metadataObject`):</span>
<span class="sd">            the type ob object to sotre in the folder (defaults to :py:class:`Stoner.Core.Data`)</span>
<span class="sd">        extra_args (dict):</span>
<span class="sd">            Extra arguments to use when instantiatoing the contents of the folder from a file on disk.</span>
<span class="sd">        pattern (str or regexp):</span>
<span class="sd">            A filename globbing pattern that matches the contents of the folder. If a regular expression is provided</span>
<span class="sd">            then any named groups are used to construct additional metadata entryies from the filename. Default</span>
<span class="sd">            is *.* to match all files with an extension.</span>
<span class="sd">        exclude (str or regexp):</span>
<span class="sd">            A filename globbing pattern that matches files to exclude from the folder.  Default is *.tdms_index to</span>
<span class="sd">            exclude all tdms index files.</span>
<span class="sd">        read_means (bool):</span>
<span class="sd">            If true, additional metatdata keys are added that return the mean value of each column of the data.</span>
<span class="sd">            This can hep in grouping files where one column of data contains a constant value for the experimental</span>
<span class="sd">            state. Default is False</span>
<span class="sd">        recursive (bool):</span>
<span class="sd">            Specifies whether to search recurisvely in a whole directory tree. Default is True.</span>
<span class="sd">        flatten (bool):</span>
<span class="sd">            Specify where to present subdirectories as spearate groups in the folder (False) or as a single group</span>
<span class="sd">            (True). Default is False. The :py:meth:`DiskBasedFolderMixin.flatten` method has the equivalent effect</span>
<span class="sd">            and :py:meth:`DiskBasedFolderMixin.unflatten` reverses it.</span>
<span class="sd">        discard_earlier (bool):</span>
<span class="sd">            If there are several files with the same filename apart from !#### being appended just before the</span>
<span class="sd">            extension, then discard all except the one with the largest value of #### when collecting the list of</span>
<span class="sd">            files.</span>
<span class="sd">        directory (str):</span>
<span class="sd">            The root directory on disc for the folder - by default this is the current working directory.</span>
<span class="sd">        multifile (boo):</span>
<span class="sd">            Whether to select individual files manually that are not (necessarily) in  a common directory structure.</span>
<span class="sd">        readlist (bool):</span>
<span class="sd">            Whether to read the directory immediately on creation. Default is True</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;extra_args&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(),</span>
        <span class="s2">&quot;pattern&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;*.*&quot;</span><span class="p">],</span>
        <span class="s2">&quot;exclude&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;*.tdms_index&quot;</span><span class="p">],</span>
        <span class="s2">&quot;read_means&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;recursive&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;flat&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;prefetch&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;directory&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;multifile&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;pruned&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;readlist&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;discard_earlier&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Additional constructor for DiskBasedFolderMixins.&quot;&quot;&quot;</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span>  <span class="c1"># Force the default store to be populated.</span>
        <span class="k">if</span> <span class="s2">&quot;directory&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_store</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_store</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_default_store</span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;type&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_store</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_store</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">==</span> <span class="n">metadataObject</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_default_store</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_Data</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span> <span class="o">!=</span> <span class="n">metadataObject</span><span class="p">:</span>  <span class="c1"># Looks like we&#39;ve already set our type in a subbclass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_default_store</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
        <span class="n">flat</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">prefetch</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;prefetch&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;prefetch&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DiskBasedFolderMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>  <span class="c1"># initialise before __clone__ is called in getlist</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">readlist</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">flat</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">prefetch</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pruned</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prune</span><span class="p">()</span>

    <span class="nd">@baseFolder</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">getter</span>  <span class="c1"># pylint: disable=no-member</span>
    <span class="k">def</span> <span class="nf">key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override the parent class *key* to use the *directory* attribute.&quot;&quot;&quot;</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">super</span><span class="p">(</span><span class="n">DiskBasedFolderMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span> <span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key</span>
        <span class="k">return</span> <span class="n">k</span>

    <span class="k">def</span> <span class="nf">_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Select Folder&quot;</span><span class="p">,</span> <span class="n">new_directory</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a directory dialog box for working with.</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            message (string):</span>
<span class="sd">                Message to display in dialog</span>
<span class="sd">            new_directory (bool):</span>
<span class="sd">                True if allowed to create new directory</span>

<span class="sd">        Returns:</span>
<span class="sd">            A directory to be used for the file operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Wildcard pattern to be used in file dialogs.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">multifile</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;directory&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;files&quot;</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">get_filedialog</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">message</span><span class="p">,</span> <span class="n">mustexist</span><span class="o">=</span><span class="ow">not</span> <span class="n">new_directory</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dlg</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">multifile</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">dlg</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dlg</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">commonprefix</span><span class="p">(</span><span class="n">dlg</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grp</span><span class="p">,</span> <span class="n">trail</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save a group of files to disc by calling the save() method on each file.</span>

<span class="sd">        This internal method is called by walk_groups in turn</span>
<span class="sd">        called from the public save() method. The trail of group keys is used to create a directory tree.</span>

<span class="sd">        Args:</span>
<span class="sd">            grp (:py:class:`objectFolder` or :py:calss:`Stoner.metadataObject`):</span>
<span class="sd">                A group or file to save trail (list of strings): the trail of paths used to get here</span>
<span class="sd">            root (string or None):</span>
<span class="sd">                a replacement root directory</span>

<span class="sd">        Returns:</span>
<span class="sd">            Saved Path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trail</span> <span class="o">=</span> <span class="p">[</span><span class="n">removeDisallowedFilenameChars</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trail</span><span class="p">]</span>
        <span class="n">grp</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">removeDisallowedFilenameChars</span><span class="p">(</span><span class="n">grp</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span>

        <span class="n">pth</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="o">*</span><span class="n">trail</span><span class="p">)</span>
        <span class="n">makedirs</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grp</span><span class="p">,</span> <span class="n">metadataObject</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="p">):</span>
            <span class="n">grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="p">(</span><span class="n">grp</span><span class="p">)</span>
        <span class="n">grp</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pth</span><span class="p">,</span> <span class="n">grp</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">grp</span><span class="o">.</span><span class="n">filename</span>

    <span class="k">def</span> <span class="nf">__lookup__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Addional logic for the looking up names.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basenames</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__names__</span><span class="p">()[</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basenames</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">DiskBasedFolderMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__lookup__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getter__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">instantiate</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the specified name from a file on disk.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            name (key type):</span>
<span class="sd">                The canonical mapping key to get the dataObject. By default</span>
<span class="sd">                the baseFolder class uses a :py:class:`regexpDict` to store objects in.</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            instatiate (bool):</span>
<span class="sd">                If True (default) then always return a :py:class:`Stoner.Core.Data` object. If False,</span>
<span class="sd">                the __getter__ method may return a key that can be used by it later to actually get the</span>
<span class="sd">                :py:class:`Stoner.Core.Data` object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (metadataObject): The metadataObject</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">assertion</span><span class="p">(</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Cannot get an anonympus entry!&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>  <span class="c1"># Try the parent methods first</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">DiskBasedFolderMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__getter__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">instantiate</span><span class="o">=</span><span class="n">instantiate</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="c1"># Find a filename and load</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">else</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">extra_args</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">StonerUnrecognisedFormat</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="c1"># Process file hooks</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_load_process</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_from_object_attrs</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
        <span class="c1"># Store the result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__setter__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">tmp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tmp</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Implement the addition operator for baseFolder and metadataObjects.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">__add_core__</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Implement the addition operator for baseFolder and metadataObjects.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">__add_core__</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Implement the addition operator for baseFolder and metadataObjects.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">__sub_core__</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="fm">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Implement the addition operator for baseFolder and metadataObjects.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">__sub_core__</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">basenames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of just the filename parts of the objectFolder.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__names__</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Just alias directory to root now.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>

    <span class="nd">@directory</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Just alias directory to root now.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">not_loaded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an array of True/False for whether we&#39;ve loaded a metadataObject yet.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__names__</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__getter__</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">instantiate</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">n</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provide support for getting the pattern attribute.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pattern</span>

    <span class="nd">@pattern</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the filename searching pattern[s] for the :py:class:`Stoner.Core.metadataObject`s.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pattern</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">_pattern_type</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pattern</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,)</span>
        <span class="k">elif</span> <span class="n">isIterable</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pattern</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;pattern should be a string, regular expression or iterable object not a </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="p">)</span>

<div class="viewcode-block" id="DiskBasedFolderMixin.fetch"><a class="viewcode-back" href="../../../classes/Stoner.folders.mixins.DiskBasedFolderMixin.html#Stoner.DiskBasedFolderMixin.fetch">[docs]</a>    <span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Preload the contents of the DiskBasedFolderMixin.</span>

<span class="sd">        With multiprocess enabled this will parallel load the contents of the folder into memory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span><span class="p">,</span> <span class="n">imap</span> <span class="o">=</span> <span class="n">get_pool</span><span class="p">()</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="n">imap</span><span class="p">(</span>
            <span class="n">partial</span><span class="p">(</span><span class="n">_loader</span><span class="p">,</span> <span class="n">loader</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">not_loaded</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__setter__</span><span class="p">(</span>
                <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_load_process</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="p">)</span>  <span class="c1"># This doesn&#39;t run on_load_process in parallel, but it&#39;s not expensive enough to make it worth it.</span>
        <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="DiskBasedFolderMixin.getlist"><a class="viewcode-back" href="../../../classes/Stoner.folders.mixins.DiskBasedFolderMixin.html#Stoner.DiskBasedFolderMixin.getlist">[docs]</a>    <span class="k">def</span> <span class="nf">getlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Scan the current directory, optionally recursively to build a list of filenames.</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            recursive (bool):</span>
<span class="sd">                Do a walk through all the directories for files</span>
<span class="sd">            directory (string or False):</span>
<span class="sd">                Either a string path to a new directory or False to open a dialog box or not set in which case existing</span>
<span class="sd">                directory is used.</span>
<span class="sd">            flatten (bool):</span>
<span class="sd">                After scanning the directory tree, flaten all the subgroupos to make a flat file list. (this is the</span>
<span class="sd">                previous behaviour of :py:meth:`objectFolder.getlist()`)</span>

<span class="sd">        Returns:</span>
<span class="sd">            A copy of the current DataFoder directory with the files stored in the files attribute</span>

<span class="sd">        getlist() scans a directory tree finding files that match the pattern. By default it will recurse through</span>
<span class="sd">        the entire directory tree finding sub directories and creating groups in the data folder for each sub</span>
<span class="sd">        directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__clear__</span><span class="p">()</span>
        <span class="n">recursive</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;recursive&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recursive</span><span class="p">)</span>
        <span class="n">discard</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;discard_earlier&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">discard_earlier</span><span class="p">)</span>
        <span class="n">flatten</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;flatten&quot;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;directory&quot;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;directory&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">directory</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dialog</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multifile</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dialog</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span>
        <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="o">=</span> <span class="n">scan_dir</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">discard</span><span class="p">:</span>
            <span class="n">files</span> <span class="o">=</span> <span class="n">discard_earlier</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">filter_files</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclude</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">filter_files</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__setter__</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Entering directory </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_group</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span>
                    <span class="n">directory</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">,</span> <span class="n">flatten</span><span class="o">=</span><span class="n">flatten</span><span class="p">,</span> <span class="n">discard_earlier</span><span class="o">=</span><span class="n">discard_earlier</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">flatten</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="DiskBasedFolderMixin.keep_latest"><a class="viewcode-back" href="../../../classes/Stoner.folders.mixins.DiskBasedFolderMixin.html#Stoner.DiskBasedFolderMixin.keep_latest">[docs]</a>    <span class="k">def</span> <span class="nf">keep_latest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Filter out earlier revisions of files with the same name.</span>

<span class="sd">        The CM group LabVIEW software will avoid overwirting files when measuring by inserting !#### where #### is an</span>
<span class="sd">        integer revision number just before the filename extension. This method will look for instances of several</span>
<span class="sd">        files which differ in name only by the presence of the revision number and will kepp only the highest revision</span>
<span class="sd">        number. This is useful if several measurements of the same experiment have been carried out, but only the</span>
<span class="sd">        last file is the correct one.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A copy of the DataFolder.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ls</span><span class="p">]</span>
        <span class="n">keep</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">discard_earlier</span><span class="p">(</span><span class="n">files</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">-</span> <span class="n">keep</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__deleter__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__lookup__</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="DiskBasedFolderMixin.on_load_process"><a class="viewcode-back" href="../../../classes/Stoner.folders.mixins.DiskBasedFolderMixin.html#Stoner.DiskBasedFolderMixin.on_load_process">[docs]</a>    <span class="k">def</span> <span class="nf">on_load_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Carry out processing on a newly loaded file to set means and extra metadata.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">_pattern_type</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">groupdict</span><span class="p">():</span>
                    <span class="n">tmp</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">string_to_type</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_means</span><span class="p">:</span>  <span class="c1"># Add mean and standard deviations to the metadata</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">tmp</span><span class="o">.</span><span class="n">column_headers</span><span class="p">:</span>
                    <span class="n">tmp</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">h</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_stdev&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">h</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">tmp</span><span class="o">.</span><span class="n">column_headers</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">tmp</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">h</span><span class="p">)))</span>
                        <span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_stdev&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">h</span><span class="p">)]</span> <span class="o">=</span> <span class="n">std</span><span class="p">(</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">h</span><span class="p">)))</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">continue</span>
        <span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;Loaded from&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">filename</span>
        <span class="k">return</span> <span class="n">tmp</span></div>

<div class="viewcode-block" id="DiskBasedFolderMixin.save"><a class="viewcode-back" href="../../../classes/Stoner.folders.mixins.DiskBasedFolderMixin.html#Stoner.DiskBasedFolderMixin.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the entire data folder out to disc using the groups as a directory tree.</span>

<span class="sd">        Calls the save method for each file in turn.</span>

<span class="sd">        Args:</span>
<span class="sd">            root (string):</span>
<span class="sd">                The root directory to start creating files and subdirectories under. If set to None or not specified,</span>
<span class="sd">                the current folder&#39;s diretory attribute will be used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of the saved files</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">walk_groups</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_save</span><span class="p">,</span> <span class="n">walker_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;root&quot;</span><span class="p">:</span> <span class="n">root</span><span class="p">})</span></div>

<div class="viewcode-block" id="DiskBasedFolderMixin.unload"><a class="viewcode-back" href="../../../classes/Stoner.folders.mixins.DiskBasedFolderMixin.html#Stoner.DiskBasedFolderMixin.unload">[docs]</a>    <span class="k">def</span> <span class="nf">unload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove the instance from memory without losing the name in the Folder.</span>

<span class="sd">        Args:</span>
<span class="sd">            name(string,int or None):</span>
<span class="sd">                Specifies the entry to unload from memeory. If set to None all loaded entries are unloaded.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (DataFolder): returns a copy of itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__lookup__</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__names__</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__setter__</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div></div>


<div class="viewcode-block" id="DataMethodsMixin"><a class="viewcode-back" href="../../../classes/Stoner.folders.mixins.DataMethodsMixin.html#Stoner.DataMethodsMixin">[docs]</a><span class="k">class</span> <span class="nc">DataMethodsMixin</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;Methods for wokring with :py:class:`Stner.Data` in py:class:`Stoner.DataFolder`s.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="DataMethodsMixin.concatenate"><a class="viewcode-back" href="../../../classes/Stoner.folders.mixins.DataMethodsMixin.html#Stoner.DataMethodsMixin.concatenate">[docs]</a>    <span class="k">def</span> <span class="nf">concatenate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Concatentates all the files in a objectFolder into a single metadataObject like object.</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            sort (column index, None or bool, or clallable function):</span>
<span class="sd">                Sort the resultant metadataObject by this column (if a column index), or by the *x* column if None</span>
<span class="sd">                or True, or not at all if False. *sort* is passed directly to the eponymous method as the</span>
<span class="sd">                *order* paramter.</span>
<span class="sd">            reverse (bool):</span>
<span class="sd">                Reverse the order of the sort (defaults to False)</span>

<span class="sd">        Returns:</span>
<span class="sd">            The current objectFolder with only one metadataObject item containing all the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d</span>
        <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sort</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">or</span> <span class="n">sort</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sort</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">or</span> <span class="n">sort</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sort</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setas</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="s2">&quot;xcol&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="DataMethodsMixin.extract"><a class="viewcode-back" href="../../../classes/Stoner.folders.mixins.DataMethodsMixin.html#Stoner.DataMethodsMixin.extract">[docs]</a>    <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">metadata</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extract metadata from each of the files in the terminal group.</span>

<span class="sd">        Walks through the terminal group and gets the listed metadata from each file and constructsa replacement</span>
<span class="sd">        metadataObject.</span>

<span class="sd">        Args:</span>
<span class="sd">            *metadata (str):</span>
<span class="sd">                One or more metadata indices that should be used to construct the new data file.</span>

<span class="sd">        Ketyword Arguments:</span>
<span class="sd">            copy (bool):</span>
<span class="sd">                Take a copy of the :py:class:`DataFolder` before starting the extract (default is True)</span>

<span class="sd">        Returns:</span>
<span class="sd">            An instance of a metadataObject like object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">copy</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">isIterable</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
                <span class="n">args</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Metadata values should be strings, or lists of strings, not </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">m</span><span class="p">)))</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">args</span>

        <span class="k">def</span> <span class="nf">_extractor</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">trail</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>

            <span class="n">results</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">type</span><span class="p">()</span>
            <span class="n">results</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">ok_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>  <span class="c1"># Sanity check the metadata to include</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">test</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">isIterable</span><span class="p">(</span><span class="n">test</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
                        <span class="n">test</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">test</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ok_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                    <span class="n">headers</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">m</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">ok_data</span><span class="p">:</span>
                    <span class="n">row</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">m</span><span class="p">]))</span>
                <span class="n">results</span> <span class="o">+=</span> <span class="n">row</span>
            <span class="n">results</span><span class="o">.</span><span class="n">column_headers</span> <span class="o">=</span> <span class="n">headers</span>

            <span class="k">return</span> <span class="n">results</span>

        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">return</span> <span class="n">ret</span><span class="o">.</span><span class="n">walk_groups</span><span class="p">(</span><span class="n">_extractor</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">replace_terminal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">walker_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="p">})</span></div>

<div class="viewcode-block" id="DataMethodsMixin.gather"><a class="viewcode-back" href="../../../classes/Stoner.folders.mixins.DataMethodsMixin.html#Stoner.DataMethodsMixin.gather">[docs]</a>    <span class="k">def</span> <span class="nf">gather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ycol</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Collect xy and y columns from the subfiles in the final group in the tree.</span>

<span class="sd">        Builds the collected data into a :py:class:`Stoner.Core.metadataObject`</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            xcol (index or None):</span>
<span class="sd">                Column in each file that has x data. if None, then the setas settings are used</span>
<span class="sd">            ycol (index or None):</span>
<span class="sd">                Column(s) in each filwe that contain the y data. If none, then the setas settings are used.</span>

<span class="sd">        Notes:</span>
<span class="sd">            This is a wrapper around walk_groups that assembles the data into a single file for</span>
<span class="sd">            further analysis or plotting.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_gatherer</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">trail</span><span class="p">,</span> <span class="n">xcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ycol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
            <span class="n">yerr</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">xerr</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_col_args</span><span class="p">(</span><span class="n">xcol</span><span class="o">=</span><span class="n">xcol</span><span class="p">,</span> <span class="n">ycol</span><span class="o">=</span><span class="n">ycol</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">xerr</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span> <span class="n">scalar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">lookup</span> <span class="o">=</span> <span class="n">xcol</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ycol</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="n">xcol</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="s2">&quot;xcol&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">cols</span><span class="p">[</span><span class="s2">&quot;has_xerr&quot;</span><span class="p">]:</span>
                <span class="n">xerr</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="s2">&quot;xerr&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xerr</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">common_x</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;common_x&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

            <span class="n">results</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">type</span><span class="p">()</span>
            <span class="n">results</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span>
            <span class="n">xbase</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">xcol</span><span class="p">)</span>
            <span class="n">xtitle</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">column_headers</span><span class="p">[</span><span class="n">xcol</span><span class="p">]</span>
            <span class="n">results</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">xbase</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">xtitle</span><span class="p">,</span> <span class="n">setas</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cols</span><span class="p">[</span><span class="s2">&quot;has_xerr&quot;</span><span class="p">]:</span>
                <span class="n">xerrdata</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">xerr</span><span class="p">)</span>
                <span class="n">xerr_title</span> <span class="o">=</span> <span class="s2">&quot;Error in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xtitle</span><span class="p">)</span>
                <span class="n">results</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">xerrdata</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">xerr_title</span><span class="p">,</span> <span class="n">setas</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lookup</span><span class="p">:</span>
                    <span class="n">cols</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">_col_args</span><span class="p">(</span><span class="n">scalar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">xcol</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="s2">&quot;xcol&quot;</span><span class="p">]</span>
                <span class="n">xdata</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">xcol</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">np_any</span><span class="p">(</span><span class="n">xdata</span> <span class="o">!=</span> <span class="n">xbase</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">common_x</span><span class="p">:</span>
                    <span class="n">xtitle</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">column_headers</span><span class="p">[</span><span class="n">xcol</span><span class="p">]</span>
                    <span class="n">results</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">xbase</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">xtitle</span><span class="p">,</span> <span class="n">setas</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
                    <span class="n">xbase</span> <span class="o">=</span> <span class="n">xdata</span>
                    <span class="k">if</span> <span class="n">cols</span><span class="p">[</span><span class="s2">&quot;has_xerr&quot;</span><span class="p">]:</span>
                        <span class="n">xerr</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="s2">&quot;xerr&quot;</span><span class="p">]</span>
                        <span class="n">xerrdata</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">xerr</span><span class="p">)</span>
                        <span class="n">xerr_title</span> <span class="o">=</span> <span class="s2">&quot;Error in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xtitle</span><span class="p">)</span>
                        <span class="n">results</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">xerrdata</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">xerr_title</span><span class="p">,</span> <span class="n">setas</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">has_err</span><span class="p">,</span> <span class="n">ecol</span><span class="p">,</span> <span class="n">setcol</span><span class="p">,</span> <span class="n">setecol</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="p">[</span><span class="s2">&quot;ycol&quot;</span><span class="p">,</span> <span class="s2">&quot;zcol&quot;</span><span class="p">,</span> <span class="s2">&quot;ucol&quot;</span><span class="p">,</span> <span class="s2">&quot;vcol&quot;</span><span class="p">,</span> <span class="s2">&quot;wcol&quot;</span><span class="p">],</span>
                    <span class="p">[</span><span class="s2">&quot;has_yerr&quot;</span><span class="p">,</span> <span class="s2">&quot;has_zerr&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
                    <span class="p">[</span><span class="s2">&quot;yerr&quot;</span><span class="p">,</span> <span class="s2">&quot;zerr&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;yzuvw&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ef...&quot;</span><span class="p">,</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="n">col</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="n">col</span><span class="p">])):</span>
                        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span> <span class="n">f</span><span class="o">.</span><span class="n">column_headers</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">i</span><span class="p">]])</span>
                        <span class="n">results</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">header</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">setas</span><span class="o">=</span><span class="n">setcol</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">has_err</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">cols</span><span class="p">[</span><span class="n">has_err</span><span class="p">]:</span>
                        <span class="n">err_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="n">ecol</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="n">ecol</span><span class="p">])):</span>
                            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span> <span class="n">f</span><span class="o">.</span><span class="n">column_headers</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="n">ecol</span><span class="p">][</span><span class="n">i</span><span class="p">]])</span>
                            <span class="n">results</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">err_data</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">header</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">setas</span><span class="o">=</span><span class="n">setecol</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">results</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">walk_groups</span><span class="p">(</span><span class="n">_gatherer</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">replace_terminal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">walker_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;xcol&quot;</span><span class="p">:</span> <span class="n">xcol</span><span class="p">,</span> <span class="s2">&quot;ycol&quot;</span><span class="p">:</span> <span class="n">ycol</span><span class="p">})</span></div></div>


<div class="viewcode-block" id="PlotMethodsMixin"><a class="viewcode-back" href="../../../classes/Stoner.folders.mixins.PlotMethodsMixin.html#Stoner.PlotMethodsMixin">[docs]</a><span class="k">class</span> <span class="nc">PlotMethodsMixin</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;A Mixin for :py:class:`Stoner.folders.core.baseFolder` with extra methods for plotting lots of files.</span>

<span class="sd">    Example:</span>
<span class="sd">        .. plot:: samples/plot-folder-test.py</span>
<span class="sd">            :include-source:</span>
<span class="sd">            :outname:  plotfolder</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;plots_per_page&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s2">&quot;fig_defaults&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">)}}</span>

<div class="viewcode-block" id="PlotMethodsMixin.figure"><a class="viewcode-back" href="../../../classes/Stoner.folders.mixins.PlotMethodsMixin.html#Stoner.PlotMethodsMixin.figure">[docs]</a>    <span class="k">def</span> <span class="nf">figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pass through for :py:func:`matplotlib.pyplot.figure` but alos takes a note of the arguments for later.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fig_args</span> <span class="o">=</span> <span class="n">args</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fig_kargs</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;fig_defaults&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fig_kargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kargs</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_fig_args</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_fig_kargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">each</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">fig</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_figure</span> <span class="o">=</span> <span class="n">fig</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_figure</span></div>

<div class="viewcode-block" id="PlotMethodsMixin.plot"><a class="viewcode-back" href="../../../classes/Stoner.folders.mixins.PlotMethodsMixin.html#Stoner.PlotMethodsMixin.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call the plot method for each metadataObject, but switching to a subplot each time.</span>

<span class="sd">        Args:</span>
<span class="sd">            args: Positional arguments to pass through to the :py:meth:`Stoner.plot.PlotMixin.plot` call.</span>
<span class="sd">            kargs: Keyword arguments to pass through to the :py:meth:`Stoner.plot.PlotMixin.plot` call.</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            extra (callable(i,j,d)):</span>
<span class="sd">                A callable that can carry out additional processing per plot after the plot is done</span>
<span class="sd">            figsize(tuple(x,y)):</span>
<span class="sd">                Size of the figure to create</span>
<span class="sd">            dpi(float):</span>
<span class="sd">                dots per inch on the figure</span>
<span class="sd">            edgecolor,facecolor(matplotlib colour):</span>
<span class="sd">                figure edge and frame colours.</span>
<span class="sd">            frameon (bool):</span>
<span class="sd">                Turns figure frames on or off</span>
<span class="sd">            FigureClass(class):</span>
<span class="sd">                Passed to matplotlib figure call.</span>
<span class="sd">            plots_per_page(int):</span>
<span class="sd">                maximum number of plots per figure.</span>
<span class="sd">            tight_layout(dict or False):</span>
<span class="sd">                If not False, arguments to pass to a call of :py:func:`matplotlib.pyplot.tight_layout`. Defaults to {}</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of :py:class:`matplotlib.pyplot.Axes` instances.</span>

<span class="sd">        Notes:</span>
<span class="sd">            If the underlying type of the :py:class:`Stoner.Core.metadataObject` instances in the</span>
<span class="sd">            :py:class:`PlotFolder` lacks a **plot** method, then the instances are converted to</span>
<span class="sd">            :py:class:`Stoner.Core.Data`.</span>

<span class="sd">            Each plot is generated as sub-plot on a page. The number of rows and columns of subplots is computed</span>
<span class="sd">            from the aspect ratio of the figure and the number of files in the :py:class:`PlotFolder`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plts</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;plots_per_page&quot;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;plots_per_page&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
        <span class="n">plts</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">plts</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="s2">&quot;plot&quot;</span><span class="p">):</span>  <span class="c1"># switch the objects to being Stoner.Data instances</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_Data</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

        <span class="n">extra</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;extra&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">tight</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;tight_layout&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="n">fig_num</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;figure&quot;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_figure&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fig_num</span><span class="p">,</span> <span class="n">Figure</span><span class="p">):</span>
            <span class="n">fig_num</span> <span class="o">=</span> <span class="n">fig_num</span><span class="o">.</span><span class="n">number</span>
        <span class="n">fig_args</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_fig_args&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">fig_kargs</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_fig_kargs&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;figsize&quot;</span><span class="p">,</span> <span class="s2">&quot;dpi&quot;</span><span class="p">,</span> <span class="s2">&quot;facecolor&quot;</span><span class="p">,</span> <span class="s2">&quot;edgecolor&quot;</span><span class="p">,</span> <span class="s2">&quot;frameon&quot;</span><span class="p">,</span> <span class="s2">&quot;FigureClass&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">kargs</span><span class="p">:</span>
                <span class="n">fig_kargs</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fig_num</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="o">*</span><span class="n">fig_args</span><span class="p">,</span> <span class="o">**</span><span class="n">fig_kargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">fig_num</span><span class="p">,</span> <span class="o">**</span><span class="n">fig_kargs</span><span class="p">)</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
        <span class="n">plt_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">plts</span> <span class="o">*</span> <span class="n">w</span> <span class="o">/</span> <span class="n">h</span><span class="p">)))</span>
        <span class="n">plt_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">plts</span> <span class="o">/</span> <span class="n">plt_x</span><span class="p">))</span>

        <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;figure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fignum</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">number</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="n">plts</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tight</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">tight_layout</span><span class="p">(</span><span class="o">**</span><span class="n">tight</span><span class="p">)</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="o">*</span><span class="n">fig_args</span><span class="p">,</span> <span class="o">**</span><span class="n">fig_kargs</span><span class="p">)</span>
                <span class="n">fignum</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">number</span>
                <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">fignum</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">subplot</span><span class="p">(</span><span class="n">plt_y</span><span class="p">,</span> <span class="n">plt_x</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;fig&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span>
            <span class="n">kargs</span><span class="p">[</span><span class="s2">&quot;ax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">))</span>
            <span class="n">extra</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
        <span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ret</span></div></div>


<span class="k">class</span> <span class="nc">DataFolder</span><span class="p">(</span><span class="n">DataMethodsMixin</span><span class="p">,</span> <span class="n">DiskBasedFolderMixin</span><span class="p">,</span> <span class="n">baseFolder</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Provide an interface to manipulating lots of data files stored within a directory structure on disc.</span>

<span class="sd">    By default, the members of the DataFolder are isntances of :class:`Stoner.Data`. The DataFolder emplys a lazy</span>
<span class="sd">    open strategy, so that files are only read in from disc when actually needed.</span>

<span class="sd">    .. inheritance-diagram:: DataFolder</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="n">make_Data</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DataFolder</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PlotFolder</span><span class="p">(</span><span class="n">PlotMethodsMixin</span><span class="p">,</span> <span class="n">DataFolder</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;A :py:class:`Stoner.folders.baseFolder` that knows how to ploth its underlying data files.&quot;&quot;&quot;</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/StonerLogo2.png" alt="Logo"/>
            </a></p>
<form class="search" action="../../../search.html" method="get">
  <input type="text" name="q"
   placeholder="type to search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="related bottom">
  <nav id="rellinks">
    <ul>
    </ul>
  </nav>
  <nav id="breadcrumbs">
    <ul>
      <li><a href="../../../index.html">Stoner Package</a></li>
      <li>
        <a href="../../index.html">Module code</a>
      </li> 
    </ul>
  </nav>
  </div>
  <footer id="pagefooter">&copy; 2013-15, Gavin Burnell et al.Last updated on Apr 13, 2020.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a>
      2.4.4
        with the <a href="http://github.com/irskep/sphinx-better-theme">
          better</a> theme.

  </footer>

  
  </body>
</html>